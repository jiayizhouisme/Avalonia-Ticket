<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="using:GetStartedApp.ViewModels"
             xmlns:converters="clr-namespace:GetStartedApp.Converters;assembly=GetStartedApp"
             xmlns:prism="http://prismlibrary.com/"
             d:DesignHeight="450"
             d:DesignWidth="800"
             prism:ViewModelLocator.AutoWireViewModel="True"
             xmlns:global="using:LayUI.Avalonia.Global"
             xmlns:lay="using:LayUI.Avalonia.Controls"
             x:Class="GetStartedApp.Views.BookingPage"
             Background="#FCF9F4">

	<UserControl.Resources>
		<converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
		<converters:BoolToBrushConverter x:Key="BoolToBrushConverter"/>
	</UserControl.Resources>
	<Grid>
		<ScrollViewer VerticalScrollBarVisibility="Auto" Margin="0,0,0,60">
			<Grid Margin="20,20,20,20" Width="450" Background="Transparent" HorizontalAlignment="Center">
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>
				<TextBlock Grid.Row="0" Text="{Binding AttractionName, StringFormat='{}{0}景区门票'}" FontSize="24" FontWeight="Bold" Margin="0,0,0,20"/>
				<StackPanel Grid.Row="1" Margin="0,0,0,20" Orientation="Horizontal" VerticalAlignment="Center">
					<TextBlock Text="选择日期" VerticalAlignment="Center"/>
					<TextBlock Text="！选择使用的日期" FontSize="12" Foreground="Gray" Margin="10,0,0,0"/>
				</StackPanel>
				<ScrollViewer x:Name="DateScrollViewer" Grid.Row="2" HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Disabled" Margin="0,0,0,30" AllowAutoHide="True">
					<ItemsControl ItemsSource="{Binding DateOptions}">
						<ItemsControl.ItemsPanel>
							<ItemsPanelTemplate>
								<StackPanel Orientation="Horizontal" Spacing="10"/>
							</ItemsPanelTemplate>
						</ItemsControl.ItemsPanel>
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<Button Command="{Binding DataContext.SelectDateCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}">
									<Button.Styles>
										<Style Selector="Button:pointerover">
											<Setter Property="Cursor" Value="Hand"/>
										</Style>
										<Style Selector="Button">
											<Setter Property="Background" Value="#F0F8FF"/>
										</Style>
									</Button.Styles>
									<Button.Template>
										<ControlTemplate>
											<Border Background="{Binding IsSelected, Converter={StaticResource BoolToBrushConverter}}" CornerRadius="5" Padding="10" BorderBrush="Gray" BorderThickness="1" Width="80" Height="40" Cursor="Hand"
                                                    PointerPressed="Border_PointerPressed" PointerMoved="Border_PointerMoved" PointerCaptureLost="Border_PointerCaptureLost">
												<Grid Background="Transparent">
													<TextBlock Text="{Binding Date, StringFormat='{}{0:MM/dd}'}" FontSize="10" VerticalAlignment="Center" HorizontalAlignment="Center"/>
													<Image Source="avares://GetStartedApp/Assets/downTip.png" MaxHeight="15" MaxWidth="15" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="-10" IsVisible="{Binding IsSelected}"/>
												</Grid>
											</Border>
										</ControlTemplate>
									</Button.Template>
								</Button>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</ScrollViewer>
				<StackPanel Grid.Row="3" Margin="0,0,0,30">
					<TextBlock Text="选择时间段" Margin="0,0,0,20"/>
					<ItemsControl ItemsSource="{Binding TimeSlots}">
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<Button Command="{Binding DataContext.SelectTimeSlotCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Margin="0,5">
									<Button.Styles>
										<Style Selector="Button:pointerover">
											<Setter Property="Cursor" Value="Hand"/>
										</Style>
										<Style Selector="Button">
											<Setter Property="Background" Value="#FAFAD2"/>
											<Setter Property="Width" Value="400"/>
											<Setter Property="Height" Value="50"/>
										</Style>
									</Button.Styles>
									<Button.Template>
										<ControlTemplate>
											<Border Background="{Binding IsSelected, Converter={StaticResource BoolToBrushConverter}}" CornerRadius="5" Padding="15" BorderBrush="Gray" BorderThickness="1" Cursor="Hand">
												<Grid>
													<Grid.ColumnDefinitions>
														<ColumnDefinition Width="Auto"/>
														<ColumnDefinition Width="*"/>
														<ColumnDefinition Width="Auto"/>
													</Grid.ColumnDefinitions>
													<TextBlock Grid.Column="0" Text="时间：" FontWeight="Bold" FontSize="12" VerticalAlignment="Center"/>
													<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="30">
														<TextBlock Text="{Binding TimeRange}" FontWeight="Bold" FontSize="12" VerticalAlignment="Center"/>
														<TextBlock Text="{Binding RemainingTickets, StringFormat='余票: {0}'}" FontSize="12" VerticalAlignment="Center"/>
														<TextBlock Text="{Binding Price, StringFormat='价格: ¥{0}'}" FontSize="12" Foreground="#D2B48C" VerticalAlignment="Center"/>
													</StackPanel>
													<Image Grid.Column="2" Source="avares://GetStartedApp/Assets/downTip.png" MaxHeight="15" MaxWidth="15" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="-15" IsVisible="{Binding IsSelected}"/>
												</Grid>
											</Border>
										</ControlTemplate>
									</Button.Template>
								</Button>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</StackPanel>
				<TextBlock Grid.Row="4" Text="选择数量" Margin="0,0,0,20"/>
				<Border Grid.Row="5" Background="#F5EFE8" CornerRadius="5" Padding="10" BorderBrush="Gray" BorderThickness="1" Margin="0,0,0,30">
					<Grid>
						<TextBlock Text="游客人数" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="0,0,0,0"/>
						<StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Spacing="20">
							<Button Content="-" Command="{Binding DecrementCommand}" Background="#D2B48C" Foreground="White" Width="30" Cursor="Hand"/>
							<Border Background="White" CornerRadius="3" Padding="5" MinWidth="50">
								<TextBlock Text="{Binding SelectedQuantity}" TextAlignment="Center"/>
							</Border>
							<Button Content="+" Command="{Binding IncrementCommand}" Background="#D2B48C" Foreground="White" Width="30" Cursor="Hand"/>
						</StackPanel>
					</Grid>
				</Border>
				<StackPanel Grid.Row="6" Margin="0,0,0,30">
					<lay:LayDialogHost global:LayDialog.Token="VisitPageDialog">
						<Grid>
							<TextBlock Text="游客信息" VerticalAlignment="Center"/>
							<StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="10">
								<TextBlock Text="{Binding RequiredVisitorsCount, StringFormat='!需增加 {0} 位游客'}"
                                           FontSize="12" Foreground="Gray" Margin="0,0,190,0"
                                           VerticalAlignment="Center"/>
								<Button Content="＋" Command="{Binding AddVisitorCommand}" CommandParameter="VisitPageDialog" Width="15" Height="15" CornerRadius="20" Background="#F0F8FF" Margin="0,0,10,0" Cursor="Hand">
									<Button.Template>
										<ControlTemplate>
											<Border Background="{TemplateBinding Background}" BorderBrush="#D2B48C" BorderThickness="2" CornerRadius="20">
												<TextBlock Text="＋" FontSize="10" Foreground="#D2B48C" FontWeight="Bold"/>
											</Border>
										</ControlTemplate>
									</Button.Template>
								</Button>
							</StackPanel>
						</Grid>
					</lay:LayDialogHost>
					<Border x:Name="VisitorButtonsContainer" Background="#F5EFE8" CornerRadius="5" Padding="10" BorderBrush="Gray" BorderThickness="1" Margin="0,20,0,0">
						<ScrollViewer VerticalScrollBarVisibility="Auto">
							<ItemsControl ItemsSource="{Binding Visitors}">
								<ItemsControl.ItemsPanel>
									<ItemsPanelTemplate>
										<WrapPanel Orientation="Horizontal" Margin="10" Width="270"/>
									</ItemsPanelTemplate>
								</ItemsControl.ItemsPanel>
								<ItemsControl.ItemTemplate>
									<DataTemplate>
										<Button Command="{Binding DataContext.ShowVisitorDetailsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Background="Transparent" BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="10" Margin="5" Width="80">
											<Grid>
												<TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="14" Cursor="Hand"/>
												<Image Source="avares://GetStartedApp/Assets/downTip.png" MaxHeight="15" MaxWidth="15" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="-10" IsVisible="{Binding IsDetailsVisible}"/>
											</Grid>
										</Button>
									</DataTemplate>
								</ItemsControl.ItemTemplate>
							</ItemsControl>
						</ScrollViewer>
					</Border>
					<Border Margin="0 10 0 10" Padding="0" BorderBrush="Transparent">
						<ScrollViewer VerticalScrollBarVisibility="Auto">
							<ItemsControl ItemsSource="{Binding Visitors}">
								<ItemsControl.ItemTemplate>
									<DataTemplate>
										<Border IsVisible="{Binding IsDetailsVisible}" Background="#FCF9F4" BorderBrush="#E0E0E0" BorderThickness="0 0 0 1" Margin="25 15 5 10" Padding="10 5 20 10">
											<Grid>
												<Grid.ColumnDefinitions>
													<ColumnDefinition Width="Auto"/>
													<ColumnDefinition Width="*"/>
													<ColumnDefinition Width="Auto"/>
												</Grid.ColumnDefinitions>
												<Button Command="{Binding DataContext.RemoveVisitorCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Grid.Column="0" Margin="5 5 10 0" Background="Transparent">
													<TextBlock Text="🗑" FontSize="14" Foreground="#999"/>
												</Button>
												<StackPanel Grid.Column="1" Margin="15 0 0 0">
													<StackPanel Orientation="Horizontal" Margin="0 0 0 5">
														<TextBlock Text="姓名：" FontWeight="Bold" FontSize="14" Width="60"/>
														<TextBlock Text="{Binding Name}" FontSize="14" Foreground="#333"/>
													</StackPanel>
													<StackPanel Orientation="Horizontal" Margin="0 0 0 5">
														<TextBlock Text="身份证：" FontWeight="Bold" FontSize="12" Foreground="#666" Width="60"/>
														<TextBlock Text="{Binding IdCard}" FontSize="12" Foreground="#666" TextTrimming="CharacterEllipsis"/>
													</StackPanel>
													<StackPanel Orientation="Horizontal" Margin="0 0 0 5">
														<TextBlock Text="手机号：" FontWeight="Bold" FontSize="12" Foreground="#666" Width="60"/>
														<TextBlock Text="{Binding PhoneNumber}" FontSize="12" Foreground="#666" TextTrimming="CharacterEllipsis"/>
													</StackPanel>
												</StackPanel>
												<Button Command="{Binding DataContext.EditVisitorCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}" CommandParameter="{Binding}" Grid.Column="2" Margin="5 5 0 0" Background="Transparent">
													<TextBlock Text="⚙️" FontSize="14" Foreground="#999"/>
												</Button>
											</Grid>
										</Border>
									</DataTemplate>
								</ItemsControl.ItemTemplate>
							</ItemsControl>
						</ScrollViewer>
					</Border>
				</StackPanel>
			</Grid>
		</ScrollViewer>
		<Border Background="Transparent" VerticalAlignment="Bottom" HorizontalAlignment="Stretch" Margin="0" Padding="0" BorderBrush="Gray" BorderThickness="0,1,0,0">
			<StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="20,10,20,10">
				<Button Content="提交订单" Command="{Binding SubmitOrderCommand}" HorizontalAlignment="Right"
                        VerticalAlignment="Center" Margin="0,0,0,0" Width="80" Height="30" CornerRadius="10"
                        Background="#FFDAB9" Foreground="Black"/>
			</StackPanel>
		</Border>
		<lay:LayDialogHost global:LayDialog.Token="ConfirmationDialog">
		</lay:LayDialogHost>
		<ContentControl prism:RegionManager.RegionName="DialogRegion" />
	</Grid>
</UserControl>